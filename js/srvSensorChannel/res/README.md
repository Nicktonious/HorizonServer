<div style = "font-family: 'Open Sans', sans-serif; font-size: 16px">

# srvChannelSensor
<div style = "color: #555">
    <p align="center">
    <img src="./res/logo.png" width="400" title="hover text">
    </p>
</div>

## Лицензия
////

### Описание
<div style = "color: #555">

**ClassChannelSensor** — это класс, представляющий канал (виртуальный датчик) в качестве службы фреймворка. Он обеспечивает
- инициализацию службы;
- хранение объекта с информацией о физическом датчике;
- конфигурацию канала (настройку мат. обработки, зон измерения, значений по умолчанию);

Собственно служба предназначена для приёма и обработки данных, получаемых от источников с дальнейшей трансляцией обработанных данных на шину, доступную пользователю.

В качестве *Name* службы принимается **ID** канала.  

### Подписки

- 'all-device-config-set' - сообщение с информацией о физическом актуаторе;
- 'dm-deviceslist-set' - сообщение со списком каналов подключенного источника;
- 'all-init-stage1-set' - этап инициализации системы;
- 'all-data-raw-get' — показание канала, поступившее от источника. 
Сокращенный формат сообщения: 
```js
{
    com: 'all-data-raw-get',
    arg: ['source1_name'],
    value: [
        {
            com: 'all-data-raw-get',
            arg: ['00-01'],
            value: [ x ]
        }
    ]
}
```
- 'all-ch-status-set' - команда на активацию/деактивацию канала;
```js
{
    com: 'all-ch-status-set',
    arg: [ch_name],
    value: [status]     //'active'/'inactive'
}
```

### Исходящие сообщения
- 'all-data-fine-get' — сообщение с последним обработанным значением канала; транслируется на **dataBus**. 
Сокращенный формат сообщения: 
```js
{
    com: 'all-get-data-fine',
    arg: ['source1_name-00-01'],
    value: [ x ]
}
```

- 'all-ch-alarm' — сообщение об изменении ткущей зоны измерения канала; транслируется на `dataBus`. 
Сокращенный формат сообщения: 
```js
{
    com: 'all-ch-alarm',
    arg: ['source1_name-00-01'],
    value: [ { redLow: 0, yelLow: 0, green: 0, yelHigh: 1, redHigh: 0 } ]
}
```

### Поля
<div style = "color: #555">

- #_SourceBus — шина, связывающая канал с источником данных;
- #_ValueBuffer — буфер для хранения значений канала;
- #_Value — текущее значение канала;
- #_Status — статус канала (не опрашивается, опрашивается и т.д.);
- #_SourceName — имя источника данных;
- #_DeviceId — идентификатор устройства;
- #_ChNum — номер канала (начиная с 0);
- #_ChangeThreshold — порог изменения для значений канала;
- #_DeviceInfo — информация о физическом датчике;
- #_Transform — настройки преобразования данных;
- #_Suppression — настройки подавления данных;
- #_Filter — фильтр для значений канала;
- #_Alarms — объект для работы с тревогами.

</div>

### Конструктор
<div style = "color: #555">

- _busList - массив шины;
- _busNameList - список имен шин;
- _chOpts - объект, содержащий настройки канала (имя источника, идентификатор устройства и номер канала);
- _deviceInfo - объект класса ClassSensorInfo, содержащий описательные характеристики датчика.

### Аксессоры
<div style="color: #555">

- get ChName - Возвращает имя канала согласно имеющейся информации об устройстве;
- get ChAlias - Возвращает alias канала;
- get ChMeas - Возвращает строковое обозначение единицы измерения показаний канала;
- get ChType - Возвращает строковое тип канала "сенсор" | "актуатор";
- get DeviceIdHash - Возвращает ID устройства, к которому относится канал;
- get Status - "active"/"inactive" в зависимости от того было ли выполнено маппирование с каналом источника и подключен ли источник в данный момент.

### Методы
<div style = "color: #555">

- EmitEvents_all_data_fine_set() - Отправляет на dataBus сообщение со значением канала.
  
- HandlerEvents_all_data_raw_get(_topic, _msg) - Обрабатывает событие получения сырого значения данных и обновляет значение канала.
  
- EmitEvents_all_ch_alarm() - Отправляет на шину сообщение с текущим состоянием зон канала.
  
- EnableAlarms() - Инициализирует объект ClassAlarms для работы с тревогами.
  
- ClearBuffer() - Очищает буфер и сбрасывает текущее значение канала.

</div>

### Пример использования
```js
const channelSensor = new ClassChannelSensor({ _busList, _busNameList }, { sourceName, deviceId, chNum }, _deviceInfo);
```

</div>